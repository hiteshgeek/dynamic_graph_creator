// Dashboard Builder Styles
@use "sass:color";
@use "../variables" as *;

// ==========================================
// Common Button Variables (centralized)
// ==========================================
// Change these to update all section/row/column buttons at once

// Text buttons (Add Section, Add Row, Add Column, Grid Size Indicator)
$builder-btn-padding: 0.35rem 0.85rem;
$builder-btn-font-size: 0.85rem;
$builder-grid-size-btn-font-size: 0.75rem;
$builder-btn-font-weight: 500;
$builder-btn-border-width: 2px;
$builder-btn-border-radius: 14px;
$builder-btn-icon-font-size: 0.85rem;
$builder-btn-box-shadow: 0 0 8px rgba(0, 0, 0, 0.15), 0 0 3px rgba(0, 0, 0, 0.1);
$builder-btn-box-shadow-hover: 0 0 12px;
$builder-btn-transition: all 0.2s;

// Icon buttons (Drag handles, Delete, Resize arrows)
$builder-icon-btn-size: 28px;
$builder-icon-btn-font-size: 0.75rem;
$builder-icon-btn-border-width: 2px;
$builder-icon-btn-border-radius: 50%;
$builder-icon-btn-box-shadow: 0 0 8px rgba(0, 0, 0, 0.15),
  0 0 3px rgba(0, 0, 0, 0.1);

// Common base mixin for all builder text buttons (section, row, column)
@mixin builder-border-btn($color-var, $hover-shadow-color) {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.35rem;
  padding: $builder-btn-padding;
  background: var(--dgc-bg-card);
  // border: $builder-btn-border-width dotted $color-var;
  border: none;
  border-radius: $builder-btn-border-radius;
  color: $color-var;
  cursor: pointer;
  font-size: $builder-btn-font-size;
  font-weight: $builder-btn-font-weight;
  line-height: 1;
  transition: $builder-btn-transition;
  box-shadow: $builder-btn-box-shadow;
  white-space: nowrap;

  i {
    font-size: $builder-btn-icon-font-size;
    line-height: 1;
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }

  span {
    line-height: 1;
    display: inline-flex;
    align-items: center;
  }

  &:hover:not([disabled]) {
    background: $color-var;
    color: var(--dgc-text-inverse);
    box-shadow: $builder-btn-box-shadow-hover $hover-shadow-color,
      0 0 4px rgba(0, 0, 0, 0.1);
  }

  &[disabled] {
    opacity: 0.5;
    cursor: not-allowed;
    background: var(--dgc-bg-elevated);
    color: var(--dgc-text-hint);
    box-shadow: 0 0 3px rgba(0, 0, 0, 0.1);
  }
}

// Common base mixin for icon buttons (drag handles, delete, resize)
@mixin builder-icon-btn($color-var, $hover-shadow-color) {
  width: $builder-icon-btn-size;
  height: $builder-icon-btn-size;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--dgc-bg-card);
  // border: $builder-icon-btn-border-width dotted $color-var;
  border: none;
  border-radius: $builder-icon-btn-border-radius;
  color: $color-var;
  cursor: pointer;
  transition: $builder-btn-transition;
  box-shadow: $builder-icon-btn-box-shadow;

  i {
    font-size: $builder-icon-btn-font-size;
  }

  &:hover:not([disabled]) {
    background: $color-var;
    color: var(--dgc-text-inverse);
    box-shadow: $builder-btn-box-shadow-hover $hover-shadow-color,
      0 0 4px rgba(0, 0, 0, 0.1);
  }

  &[disabled] {
    opacity: 0.5;
    cursor: not-allowed;
    background: var(--dgc-bg-elevated);
    color: var(--dgc-text-hint);
    box-shadow: 0 0 3px rgba(0, 0, 0, 0.1);
  }
}

.dashboard-builder {
  min-height: calc(100vh - 60px);

  .builder-body {
    display: flex;
    min-height: calc(100vh - 85px);

    .builder-main {
      flex: 1;
      padding: $spacing-lg;
      overflow-y: auto;

      .grid-editor {
        // max-width: 1400px;
        // margin: 0 auto;
        position: relative;
      }
    }
  }

  // Dashboard sections - no vertical centering
  .dashboard-sections {
    position: relative;
  }

  // Section wrapper for border button positioning
  .dashboard-section-wrapper {
    position: relative;

    &.section-ghost {
      opacity: 0.4;
    }
  }

  // Add Section Border Buttons (on section borders) - Blue/Primary
  .add-section-border-btn {
    @include builder-border-btn(var(--dgc-primary), rgba(0, 123, 255, 0.3));
    position: absolute;
    left: 50%;
    transform: translateX(-50%) translateY(-50%);
    opacity: 0;
    pointer-events: none;
    z-index: 10;
  }

  // Top border button
  .add-section-top-btn {
    top: 0;
  }

  // Bottom border button
  .add-section-bottom-btn {
    bottom: 0;
    transform: translateX(-50%) translateY(50%);
  }

  // Section top border controls (reorder/delete)
  .section-top-border-controls {
    position: absolute;
    top: 0;
    transform: translateY(-50%);
    right: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    opacity: 0;
    pointer-events: none;
    transition: $builder-btn-transition;
    z-index: 11;

    .section-control-btn {
      @include builder-icon-btn(var(--dgc-border-color), rgba(0, 0, 0, 0.2));
      color: var(--dgc-text-secondary);

      &.drag-handle {
        cursor: grab;
        border-color: var(--dgc-primary);
        color: var(--dgc-primary);

        &:active {
          cursor: grabbing;
        }

        &:hover {
          background: var(--dgc-primary);
          box-shadow: $builder-btn-box-shadow-hover rgba(0, 123, 255, 0.3);
        }
      }

      &.remove-btn {
        border-color: var(--dgc-error);
        color: var(--dgc-error);

        &:hover {
          background: var(--dgc-error);
          box-shadow: $builder-btn-box-shadow-hover rgba(244, 67, 54, 0.3);
        }
      }
    }
  }

  // Desktop: show on hover of section wrapper
  @media (min-width: 1024px) {
    .dashboard-section-wrapper:hover .add-section-border-btn,
    .dashboard-section-wrapper:hover .section-top-border-controls {
      opacity: 1;
      pointer-events: auto;
    }
  }

  // Tablet and mobile: always visible
  @media (max-width: 1023px) {
    .add-section-border-btn,
    .section-top-border-controls {
      opacity: 1;
      pointer-events: auto;
    }
  }

  // Column drag handle - positioned at top left of column
  // Circular shape, Color: Orange/Warning
  .column-drag-handle {
    @include builder-icon-btn(var(--dgc-warning), rgba(255, 193, 7, 0.4));
    position: absolute;
    top: 0;
    left: 0;
    transform: translate(-50%, -50%);
    cursor: grab;
    z-index: 15;
    opacity: 0;
    pointer-events: none;

    &:active {
      cursor: grabbing;
    }
  }

  // Row drag handle - positioned at top right of row
  // Circular shape, Color: Green/Success
  .row-drag-handle {
    @include builder-icon-btn(var(--dgc-success), rgba(40, 167, 69, 0.4));
    position: absolute;
    top: 0;
    right: 0;
    transform: translate(50%, -50%);
    cursor: grab;
    z-index: 15;
    opacity: 0;
    pointer-events: none;

    &:active {
      cursor: grabbing;
    }
  }

  // Show drag handles on hover (desktop)
  @media (min-width: 1024px) {
    .dashboard-area:hover > .area-controls-overlay .column-drag-handle,
    .dashboard-sub-row:hover > .area-controls-overlay .column-drag-handle,
    .dashboard-sub-row:hover > .area-controls-overlay .row-drag-handle {
      opacity: 1;
      pointer-events: auto;
    }
  }

  // Tablet and mobile: always visible
  @media (max-width: 1023px) {
    .column-drag-handle,
    .row-drag-handle {
      opacity: 1;
      pointer-events: auto;
    }
  }

  // Ghost classes for drag-drop visual feedback
  .column-ghost {
    opacity: 0.4;
    background: rgba($warning, 0.15);
    border: 2px dashed $warning;
    border-radius: 8px;
  }

  .row-ghost {
    opacity: 0.4;
    background: rgba($success, 0.15);
    border: 2px dashed $success;
    border-radius: 6px;
  }

  // Loader styles moved to common _loader.scss

  .responsive-toggle {
    display: flex;
    gap: 0.25rem;
    margin-right: 1rem;

    .breakpoint-btn {
      padding: 0.5rem 0.75rem;
      border: 1px solid var(--dgc-border-color);
      background: var(--dgc-bg-card);
      color: var(--dgc-text-secondary);
      cursor: pointer;
      border-radius: 4px;
      transition: all 0.2s;

      &:hover {
        background: var(--dgc-bg-elevated);
      }

      &.active {
        background: var(--dgc-primary);
        color: var(--dgc-text-inverse);
        border-color: var(--dgc-primary);
      }
    }
  }
}

// Dashboard Name Editor
.dashboard-name-editor {
  display: flex;
  align-items: center;
  gap: 0.5rem;

  h1 {
    margin: 0;
    font-size: $font-size-h2;
    line-height: 1;
  }

  .description-tooltip {
    color: var(--dgc-text-secondary);
    cursor: help;
    font-size: 1rem;

    &:hover {
      color: var(--dgc-primary);
    }
  }

}

// Save Indicator (matches btn-sm sizing)
.save-indicator {
  display: flex;
  align-items: center;
  gap: 0.375rem;
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
  font-size: 0.8125rem;
  font-weight: 500;
  transition: all 0.3s;

  i {
    font-size: 0.875rem;
  }

  &.saved {
    color: var(--dgc-success);
    background: var(--dgc-success-bg);

    i {
      color: var(--dgc-success);
    }
  }

  &.saving {
    color: var(--dgc-info);
    background: var(--dgc-info-bg);

    i {
      color: var(--dgc-info);
    }
  }

  &.unsaved {
    color: var(--dgc-warning);
    background: var(--dgc-warning-bg);

    i {
      color: var(--dgc-warning);
    }
  }

  &.error {
    color: var(--dgc-error);
    background: var(--dgc-error-bg);

    i {
      color: var(--dgc-error);
    }
  }
}

// ==========================================
// Section Editor Styles
// ==========================================

// Section container for positioning resize handles
.dashboard-section-container {
  position: relative;
  flex: 1;
}

// Column resize controls container (positioned over the grid)
.column-resize-controls {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  pointer-events: none;
  z-index: 20;
}

// Unified area controls overlay - used in both dashboard-area and dashboard-sub-row
.area-controls-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s;
  z-index: 15;
  background: rgba(255, 255, 255, 0.85);
  border-radius: 6px;

  &:focus,
  &:focus-visible {
    outline: none;
  }
}

// Edge buttons (Add Row / Add Column) - positioned on border edges like section buttons
// Uses common mixin but with position-specific overrides for colors
.edge-btn {
  @include builder-border-btn(var(--dgc-primary), rgba(0, 123, 255, 0.3));
  position: absolute;
  z-index: 10;

  // Row buttons (Top/Bottom) - Green/Success
  &.edge-top,
  &.edge-bottom {
    background: var(--dgc-bg-card);
    box-shadow: $builder-btn-box-shadow;
    color: var(--dgc-success);

    &:hover:not([disabled]) {
      background: var(--dgc-success);
      box-shadow: $builder-btn-box-shadow-hover rgba(40, 167, 69, 0.4);
    }

    &[disabled] {
      opacity: 1;
      background: var(--dgc-bg-card);
      color: var(--dgc-text-hint);
      box-shadow: $builder-btn-box-shadow;
    }
  }

  &.edge-top {
    top: 0;
    left: 50%;
    transform: translateX(-50%) translateY(-50%);
  }

  &.edge-bottom {
    bottom: 0;
    left: 50%;
    transform: translateX(-50%) translateY(50%);
  }

  // Column buttons (Left/Right) - Orange/Warning
  &.edge-left,
  &.edge-right {
    background: var(--dgc-bg-card);
    box-shadow: $builder-btn-box-shadow;
    color: var(--dgc-warning);

    &:hover:not([disabled]) {
      background: var(--dgc-warning);
      box-shadow: $builder-btn-box-shadow-hover rgba(255, 193, 7, 0.4);
    }

    &[disabled] {
      opacity: 1;
      background: var(--dgc-bg-card);
      color: var(--dgc-text-hint);
      box-shadow: $builder-btn-box-shadow;
    }
  }

  &.edge-left {
    left: 0;
    top: 50%;
    transform: translateX(-50%) translateY(-50%) rotate(-90deg);
  }

  &.edge-right {
    right: 0;
    top: 50%;
    transform: translateX(50%) translateY(-50%) rotate(-90deg);
  }
}

// Center controls (resize arrows + delete)
.center-controls {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
}

.center-row {
  display: flex;
  align-items: center;
  gap: 6px;
}

// Center button (resize arrows) - uses shared icon button styles
.center-btn {
  @include builder-icon-btn(var(--dgc-border-color), rgba(0, 123, 255, 0.3));
  border-width: 1px; // Thinner border for arrows
  color: var(--dgc-text-primary);

  // Row resize buttons (up/down) - Green/Success
  &.row-resize {
    &:hover:not([disabled]) {
      background: var(--dgc-success);
      border-color: var(--dgc-success);
      color: var(--dgc-text-inverse);
      box-shadow: $builder-btn-box-shadow-hover rgba(40, 167, 69, 0.4),
        0 0 4px rgba(0, 0, 0, 0.1);
    }
  }

  // Column resize buttons (left/right) - Orange/Warning
  &.col-resize {
    &:hover:not([disabled]) {
      background: var(--dgc-warning);
      border-color: var(--dgc-warning);
      color: var(--dgc-text-inverse);
      box-shadow: $builder-btn-box-shadow-hover rgba(255, 193, 7, 0.4),
        0 0 4px rgba(0, 0, 0, 0.1);
    }
  }

  // Fallback for arrows without specific class - primary
  &:hover:not([disabled]):not(.row-resize):not(.col-resize):not(.delete-btn):not(.edit-btn) {
    background: var(--dgc-primary);
    border-color: var(--dgc-primary);
  }

  // Delete button in center - visible colored border, colored hover
  &.delete-btn {
    border-width: $builder-icon-btn-border-width;
    border-color: var(--dgc-error);
    color: var(--dgc-error);

    &:hover:not([disabled]) {
      background: var(--dgc-error);
      border-color: var(--dgc-error);
      box-shadow: $builder-btn-box-shadow-hover rgba(244, 67, 54, 0.3);
    }
  }

  // Edit button in center - visible colored border (warning/orange), colored hover
  &.edit-btn {
    border-width: $builder-icon-btn-border-width;
    border-color: var(--dgc-warning);
    color: var(--dgc-warning);

    &:hover:not([disabled]) {
      background: var(--dgc-warning);
      border-color: var(--dgc-warning);
      color: var(--dgc-text-inverse);
      box-shadow: $builder-btn-box-shadow-hover rgba(255, 152, 0, 0.3);
    }
  }
}

// Grid size indicator (positioned at bottom-right on section border, using shared button variables)
.grid-size-indicator {
  position: absolute;
  bottom: 0;
  transform: translateY(50%);
  right: 1rem;
  background: var(--dgc-bg-card);
  border: none;
  border-radius: $builder-btn-border-radius;
  padding: $builder-btn-padding;
  font-size: $builder-grid-size-btn-font-size;
  font-family: monospace;
  font-weight: $builder-btn-font-weight;
  line-height: 1;
  color: var(--dgc-text-secondary);
  white-space: nowrap;
  opacity: 0;
  pointer-events: none;
  transition: $builder-btn-transition;
  z-index: 10;
  box-shadow: $builder-btn-box-shadow;
  display: flex;
  align-items: center;
  gap: 0.25rem;

  // Column highlight (orange - matches column drag handlers)
  .grid-size-part {
    padding: 0.25rem;
    border-radius: 4px;
    transition: all 0.15s ease;

    &.active {
      background: rgba($warning, 0.15);
      color: var(--dgc-warning);
      font-weight: 600;
    }

    // Nested part doesn't highlight as a whole, only individual rows
    &.grid-size-part-nested {
      &.active {
        background: transparent;
        color: inherit;
        font-weight: 500;
      }
    }
  }

  .grid-size-separator {
    color: var(--dgc-text-hint);
  }

  .grid-size-row-sep {
    color: var(--dgc-text-hint);
  }

  // Row highlight (green - matches row drag handlers)
  .grid-size-row {
    padding: 0.0625rem 0.25rem;
    border-radius: 3px;
    transition: all 0.15s ease;

    &.active {
      background: rgba($success, 0.15);
      color: var(--dgc-success);
      font-weight: 600;
    }
  }
}

// Area controls (split, remove column)
.area-controls {
  position: absolute;
  top: 4px;
  right: 4px;
  display: flex;
  gap: 4px;
  opacity: 0;
  pointer-events: none;
  transition: all 0.2s;
  z-index: 12;

  &.nested-area-controls {
    top: 0;
    transform: translateY(-50%);
    right: 4px;
  }
}

// Area control buttons (split, remove column) - uses shared icon button styles
.area-control-btn {
  @include builder-icon-btn(var(--dgc-border-color), rgba(0, 0, 0, 0.2));
  border-width: 1px;
  color: var(--dgc-text-secondary);

  &.split-column-btn {
    border-color: var(--dgc-primary);
    color: var(--dgc-primary);

    &:hover {
      background: var(--dgc-primary);
      box-shadow: $builder-btn-box-shadow-hover rgba(0, 123, 255, 0.3);
    }
  }

  &.remove-column-btn {
    border-color: var(--dgc-error);
    color: var(--dgc-error);

    &:hover {
      background: var(--dgc-error);
      box-shadow: $builder-btn-box-shadow-hover rgba(244, 67, 54, 0.3);
    }
  }
}

// Old resize styles removed - now using toolbar-style .btn-toolbar-group

// Row controls
.row-controls {
  position: absolute;
  top: 4px;
  right: 4px;
  display: flex;
  gap: 4px;
  opacity: 0;
  pointer-events: none;
  transition: all 0.2s;
  z-index: 12;
}

// Row control button (delete row) - uses shared icon button styles
.row-control-btn {
  @include builder-icon-btn(var(--dgc-error), rgba(244, 67, 54, 0.3));
  width: 20px; // Slightly smaller
  height: 20px;
  border-width: 1px;
}

// Show controls on hover (desktop)
@media (min-width: 1024px) {
  .dashboard-section-wrapper:hover {
    .grid-size-indicator {
      opacity: 1;
    }
  }

  // Area hover - show controls (works for both dashboard-area and dashboard-sub-row)
  .dashboard-area:hover,
  .dashboard-sub-row:hover {
    > .area-controls-overlay {
      opacity: 1;
      pointer-events: auto;

      .edge-btn,
      .center-btn {
        pointer-events: auto;
      }
    }
  }

  // Show controls when parent area is focused (keyboard navigation)
  .dashboard-area:focus > .area-controls-overlay,
  .dashboard-sub-row:focus > .area-controls-overlay {
    opacity: 1;
    pointer-events: auto;

    .edge-btn,
    .center-btn {
      pointer-events: auto;
    }
  }
}

// Tablet and mobile: always show essential controls
@media (max-width: 1023px) {
  .area-controls-overlay {
    opacity: 1;
    pointer-events: auto;

    .edge-btn,
    .center-btn {
      pointer-events: auto;
    }
  }

  .grid-size-indicator {
    opacity: 1;
  }
}

// Tweak Mode Toggle
// When tweak mode is disabled, hide area-level layout controls but keep section-level controls visible
// Section controls (add section, rearrange section, delete section) remain available in design mode
.dashboard-builder.layout-edit-disabled {
  // Hide area controls overlay (resize buttons, add row/col buttons within areas)
  .area-controls-overlay {
    display: none !important;
  }

  // Hide column and row drag handles (within sections)
  .column-drag-handle,
  .row-drag-handle {
    display: none !important;
  }

  // Hide grid size indicator
  .grid-size-indicator {
    display: none !important;
  }

  // Dashboard area styling - primary border on hover/focus
  .dashboard-area:not(.dashboard-area-nested) {
    &:hover,
    &:focus {
      border-color: var(--dgc-primary);
    }
  }

  // Sub-row styling - primary border on hover/focus
  .dashboard-sub-row {
    &:hover,
    &:focus {
      border-color: var(--dgc-primary);
    }
  }

  // Keep empty state visible and clickable
  .dashboard-cell-empty {
    cursor: pointer;

    &:hover {
      border-color: $primary;
    }
  }
}
