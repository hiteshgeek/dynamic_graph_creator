// Dashboard Builder Styles
@use "../variables" as *;

.dashboard-builder {
  min-height: calc(100vh - 60px);

  .builder-body {
    display: flex;
    min-height: calc(100vh - 80px);

    .builder-main {
      flex: 1;
      padding: $spacing-lg;
      overflow-y: auto;

      .grid-editor {
        // max-width: 1400px;
        // margin: 0 auto;
        position: relative;
      }
    }
  }

  // Dashboard sections - no vertical centering
  .dashboard-sections {
    position: relative;
  }

  // Section wrapper for border button positioning
  .dashboard-section-wrapper {
    position: relative;

    &.section-ghost {
      opacity: 0.4;
    }
  }

  // Add Section Border Buttons (on section borders)
  .add-section-border-btn {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.375rem;
    padding: 0.375rem 1rem;
    background: white;
    border: 2px solid $primary;
    border-radius: 20px;
    color: $primary;
    cursor: pointer;
    font-size: 0.8rem;
    font-weight: 500;
    transition: all 0.2s;
    opacity: 0;
    pointer-events: none;
    z-index: 10;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    white-space: nowrap;

    i {
      font-size: 0.75rem;
    }

    &:hover {
      background: $primary;
      color: white;
      box-shadow: 0 3px 8px rgba(0, 123, 255, 0.3);
    }
  }

  // Top border button
  .add-section-top-btn {
    top: -16px; // Half of button height to center on border
  }

  // Bottom border button
  .add-section-bottom-btn {
    bottom: -16px; // Half of button height to center on border
  }

  // Section top border controls (reorder/delete)
  .section-top-border-controls {
    position: absolute;
    top: -16px;
    right: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    opacity: 0;
    pointer-events: none;
    transition: all 0.2s;
    z-index: 11;

    .section-control-btn {
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: white;
      border: 2px solid #dee2e6;
      border-radius: 50%;
      color: #6c757d;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);

      i {
        font-size: 0.875rem;
      }

      &.drag-handle {
        cursor: grab;
        border-color: $primary;
        color: $primary;

        &:active {
          cursor: grabbing;
        }

        &:hover {
          background: $primary;
          color: white;
        }
      }

      &.remove-btn {
        border-color: #dc3545;
        color: #dc3545;

        &:hover {
          background: #dc3545;
          color: white;
        }
      }
    }
  }

  // Desktop: show on hover of section wrapper
  @media (min-width: 1024px) {
    .dashboard-section-wrapper:hover .add-section-border-btn,
    .dashboard-section-wrapper:hover .section-top-border-controls {
      opacity: 1;
      pointer-events: auto;
    }
  }

  // Tablet and mobile: always visible
  @media (max-width: 1023px) {
    .add-section-border-btn,
    .section-top-border-controls {
      opacity: 1;
      pointer-events: auto;
    }
  }

  // Column drag handle - positioned at top left of column
  // Shape: Square with rounded corners, Color: Orange/Warning
  .column-drag-handle {
    position: absolute;
    top: -16px;
    left: -16px;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: white;
    border: 2px solid $warning;
    border-radius: 6px; // Square with rounded corners
    color: $warning;
    cursor: grab;
    transition: all 0.2s;
    z-index: 15;
    opacity: 0;
    pointer-events: none;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);

    i {
      font-size: 0.875rem;
    }

    &:active {
      cursor: grabbing;
    }

    &:hover {
      background: $warning;
      color: white;
      box-shadow: 0 3px 8px rgba(255, 193, 7, 0.4);
    }
  }

  // Row drag handle - positioned at top right of row
  // Shape: Pill/Stadium, Color: Green/Success
  .row-drag-handle {
    position: absolute;
    top: -14px;
    right: -20px;
    width: 40px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: white;
    border: 2px solid $success;
    border-radius: 14px; // Pill shape
    color: $success;
    cursor: grab;
    transition: all 0.2s;
    z-index: 15;
    opacity: 0;
    pointer-events: none;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);

    i {
      font-size: 0.875rem;
    }

    &:active {
      cursor: grabbing;
    }

    &:hover {
      background: $success;
      color: white;
      box-shadow: 0 3px 8px rgba(40, 167, 69, 0.4);
    }
  }

  // Show drag handles on hover (desktop)
  @media (min-width: 1024px) {
    .dashboard-area:hover > .area-controls-overlay .column-drag-handle,
    .dashboard-sub-row:hover > .area-controls-overlay .column-drag-handle,
    .dashboard-sub-row:hover > .area-controls-overlay .row-drag-handle {
      opacity: 1;
      pointer-events: auto;
    }
  }

  // Tablet and mobile: always visible
  @media (max-width: 1023px) {
    .column-drag-handle,
    .row-drag-handle {
      opacity: 1;
      pointer-events: auto;
    }
  }

  // Ghost classes for drag-drop visual feedback
  .column-ghost {
    opacity: 0.4;
    background: rgba($warning, 0.15);
    border: 2px dashed $warning;
    border-radius: 8px;
  }

  .row-ghost {
    opacity: 0.4;
    background: rgba($success, 0.15);
    border: 2px dashed $success;
    border-radius: 6px;
  }

  // Loader styles moved to common _loader.scss

  .responsive-toggle {
    display: flex;
    gap: 0.25rem;
    margin-right: 1rem;

    .breakpoint-btn {
      padding: 0.5rem 0.75rem;
      border: 1px solid #dee2e6;
      background: white;
      color: #6c757d;
      cursor: pointer;
      border-radius: 4px;
      transition: all 0.2s;

      &:hover {
        background: #e9ecef;
      }

      &.active {
        background: $primary;
        color: white;
        border-color: $primary;
      }
    }
  }
}

// Dashboard Name Editor
.dashboard-name-editor {
  display: flex;
  align-items: center;
  gap: 0.5rem;

  h1 {
    margin: 0;
    font-size: $font-size-h2;
    line-height: 1;
  }

  .dashboard-name-input {
    // font-size: $font-size-h2;
    font-weight: 600;
    min-width: 250px;
  }

  .btn-icon {
    width: 32px;
    height: 32px;
    min-width: 32px;
    min-height: 32px;
    padding: 0 !important;
    border-radius: 50% !important;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border: 1px solid #dee2e6;
    background: white;
    color: #6c757d;
    cursor: pointer;
    transition: all 0.2s;
    font-size: 0.875rem;
    flex-shrink: 0;

    &.btn-warning {
      border-color: #ffc107;
      color: #ffc107;

      &:hover {
        background: #ffc107;
        color: white;
      }
    }

    &.btn-success {
      border-color: #198754;
      color: #198754;

      &:hover {
        background: #198754;
        color: white;
      }
    }

    &.btn-secondary {
      border-color: #6c757d;
      color: #6c757d;

      &:hover {
        background: #6c757d;
        color: white;
      }
    }
  }
}

// Save Indicator
.save-indicator {
  display: flex;
  align-items: center;
  gap: $spacing-sm;
  padding: 0.5rem 0.75rem;
  border-radius: 6px;
  font-size: 0.875rem;
  font-weight: 500;
  transition: all 0.3s;

  i {
    font-size: 1rem;
  }

  &.saved {
    color: $success;
    background: $success-bg;

    i {
      color: $success;
    }
  }

  &.saving {
    color: $info;
    background: $info-bg;

    i {
      color: $info;
    }
  }

  &.unsaved {
    color: $warning;
    background: $warning-bg;

    i {
      color: $warning;
    }
  }

  &.error {
    color: $error;
    background: $error-bg;

    i {
      color: $error;
    }
  }
}

// ==========================================
// Section Editor Styles
// ==========================================

// Section container for positioning resize handles
.dashboard-section-container {
  position: relative;
  flex: 1;
}

// Column resize controls container (positioned over the grid)
.column-resize-controls {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  pointer-events: none;
  z-index: 20;
}

// Unified area controls overlay - used in both dashboard-area and dashboard-sub-row
.area-controls-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s;
  z-index: 15;
  background: rgba(255, 255, 255, 1);
  border-radius: 6px;
}

// Edge buttons (Add Row / Add Column) - consistent 12px from each edge
.edge-btn {
  position: absolute;
  padding: 0.25rem 0.75rem;
  background: white;
  border: 1px solid #dee2e6;
  border-radius: 4px;
  font-size: 0.7rem;
  font-weight: 500;
  color: #495057;
  cursor: pointer;
  white-space: nowrap;
  transition: all 0.15s;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);

  &:hover:not([disabled]) {
    background: $primary;
    color: white;
    border-color: $primary;
  }

  &[disabled] {
    opacity: 0.5;
    cursor: not-allowed;
    background: #f8f9fa;
  }

  // Top edge - 12px from top
  &.edge-top {
    top: 12px;
    left: 50%;
    transform: translateX(-50%);
  }

  // Bottom edge - 12px from bottom
  &.edge-bottom {
    bottom: 12px;
    left: 50%;
    transform: translateX(-50%);
  }

  // Left edge - visually same distance as top/bottom buttons
  &.edge-left {
    left: 0;
    top: 50%;
    transform: translateX(-50%) translateX(24px) translateY(-50%) rotate(-90deg);
    transform-origin: center;
  }

  // Right edge - visually same distance as top/bottom buttons
  &.edge-right {
    right: 0;
    top: 50%;
    transform: translateX(50%) translateX(-24px) translateY(-50%) rotate(90deg);
    transform-origin: center;
  }
}

// Center controls (resize arrows + delete)
.center-controls {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 2px;
}

.center-row {
  display: flex;
  align-items: center;
  gap: 2px;
}

.center-btn {
  width: 28px;
  height: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: white;
  border: 1px solid #dee2e6;
  border-radius: 50%;
  color: #495057;
  cursor: pointer;
  font-size: 0.875rem;
  transition: all 0.15s;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.06);

  // Arrow buttons turn primary on hover
  &:hover:not([disabled]) {
    background: $primary;
    color: white;
    border-color: $primary;
  }

  &[disabled] {
    opacity: 0.5;
    cursor: not-allowed;
    background: #f8f9fa;
    color: #adb5bd;
  }

  // Delete button in center - visible red border, red hover
  &.delete-btn {
    border: 2px solid #dc3545;
    color: #dc3545;

    &:hover:not([disabled]) {
      background: #dc3545;
      color: white;
      border-color: #dc3545;
    }
  }
}

// Grid size indicator (positioned at bottom-right on section border, matching Add Section button height)
.grid-size-indicator {
  position: absolute;
  bottom: -16px;
  right: 1rem;
  background: white;
  border: 1px solid #dee2e6;
  border-radius: 20px;
  padding: 0.375rem 1rem;
  font-size: 0.8rem;
  font-family: monospace;
  font-weight: 500;
  color: #6c757d;
  white-space: nowrap;
  opacity: 0;
  pointer-events: none;
  transition: all 0.2s;
  z-index: 10;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

// Area controls (split, remove column)
.area-controls {
  position: absolute;
  top: 4px;
  right: 4px;
  display: flex;
  gap: 4px;
  opacity: 0;
  pointer-events: none;
  transition: all 0.2s;
  z-index: 12;

  &.nested-area-controls {
    top: -12px;
    right: 4px;
  }
}

.area-control-btn {
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: white;
  border: 1px solid #dee2e6;
  border-radius: 50%;
  color: #6c757d;
  cursor: pointer;
  font-size: 0.7rem;
  transition: all 0.2s;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);

  &.split-column-btn {
    border-color: $primary;
    color: $primary;

    &:hover {
      background: $primary;
      color: white;
    }
  }

  &.remove-column-btn {
    border-color: #dc3545;
    color: #dc3545;

    &:hover {
      background: #dc3545;
      color: white;
    }
  }
}

// Old resize styles removed - now using toolbar-style .btn-toolbar-group

// Row controls
.row-controls {
  position: absolute;
  top: 4px;
  right: 4px;
  display: flex;
  gap: 4px;
  opacity: 0;
  pointer-events: none;
  transition: all 0.2s;
  z-index: 12;
}

.row-control-btn {
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: white;
  border: 1px solid #dc3545;
  border-radius: 50%;
  color: #dc3545;
  cursor: pointer;
  font-size: 0.6rem;
  transition: all 0.2s;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);

  &:hover {
    background: #dc3545;
    color: white;
  }
}

// Show controls on hover (desktop)
@media (min-width: 1024px) {
  .dashboard-section-wrapper:hover {
    .grid-size-indicator {
      opacity: 1;
    }
  }

  // Area hover - show controls (works for both dashboard-area and dashboard-sub-row)
  .dashboard-area:hover,
  .dashboard-sub-row:hover {
    > .area-controls-overlay {
      opacity: 1;
      pointer-events: auto;

      .edge-btn,
      .center-btn {
        pointer-events: auto;
      }
    }
  }
}

// Tablet and mobile: always show essential controls
@media (max-width: 1023px) {
  .area-controls-overlay {
    opacity: 1;
    pointer-events: auto;

    .edge-btn,
    .center-btn {
      pointer-events: auto;
    }
  }

  .grid-size-indicator {
    opacity: 1;
  }
}
