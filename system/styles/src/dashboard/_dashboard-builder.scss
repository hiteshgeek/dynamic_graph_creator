// Dashboard Builder Styles
@use "sass:color";
@use "../variables" as *;

.dashboard-builder {
  min-height: calc(100vh - 60px);

  .builder-body {
    display: flex;
    min-height: calc(100vh - 80px);

    .builder-main {
      flex: 1;
      padding: $spacing-lg;
      overflow-y: auto;

      .grid-editor {
        // max-width: 1400px;
        // margin: 0 auto;
        position: relative;
      }
    }
  }

  // Dashboard sections - no vertical centering
  .dashboard-sections {
    position: relative;
  }

  // Section wrapper for border button positioning
  .dashboard-section-wrapper {
    position: relative;

    &.section-ghost {
      opacity: 0.4;
    }
  }

  // Add Section Border Buttons (on section borders)
  .add-section-border-btn {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.375rem;
    padding: 0.375rem 1rem;
    background: var(--dgc-bg-card);
    border: 2px solid var(--dgc-primary);
    border-radius: 20px;
    color: var(--dgc-primary);
    cursor: pointer;
    font-size: 0.8rem;
    font-weight: 500;
    transition: all 0.2s;
    opacity: 0;
    pointer-events: none;
    z-index: 10;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    white-space: nowrap;

    i {
      font-size: 0.75rem;
    }

    &:hover {
      background: var(--dgc-primary);
      color: var(--dgc-text-inverse);
      box-shadow: 0 3px 8px rgba(0, 123, 255, 0.3);
    }
  }

  // Top border button
  .add-section-top-btn {
    top: -16px; // Half of button height to center on border
  }

  // Bottom border button
  .add-section-bottom-btn {
    bottom: -16px; // Half of button height to center on border
  }

  // Section top border controls (reorder/delete)
  .section-top-border-controls {
    position: absolute;
    top: -16px;
    right: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    opacity: 0;
    pointer-events: none;
    transition: all 0.2s;
    z-index: 11;

    .section-control-btn {
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--dgc-bg-card);
      border: 2px solid var(--dgc-border-color);
      border-radius: 50%;
      color: var(--dgc-text-secondary);
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);

      i {
        font-size: 0.875rem;
      }

      &.drag-handle {
        cursor: grab;
        border-color: var(--dgc-primary);
        color: var(--dgc-primary);

        &:active {
          cursor: grabbing;
        }

        &:hover {
          background: var(--dgc-primary);
          color: var(--dgc-text-inverse);
        }
      }

      &.remove-btn {
        border-color: var(--dgc-error);
        color: var(--dgc-error);

        &:hover {
          background: var(--dgc-error);
          color: var(--dgc-text-inverse);
        }
      }
    }
  }

  // Desktop: show on hover of section wrapper
  @media (min-width: 1024px) {
    .dashboard-section-wrapper:hover .add-section-border-btn,
    .dashboard-section-wrapper:hover .section-top-border-controls {
      opacity: 1;
      pointer-events: auto;
    }
  }

  // Tablet and mobile: always visible
  @media (max-width: 1023px) {
    .add-section-border-btn,
    .section-top-border-controls {
      opacity: 1;
      pointer-events: auto;
    }
  }

  // Column drag handle - positioned at top left of column
  // Shape: Square with rounded corners, Color: Orange/Warning
  .column-drag-handle {
    position: absolute;
    top: -16px;
    left: -16px;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--dgc-bg-card);
    border: 2px solid var(--dgc-warning);
    border-radius: 6px; // Square with rounded corners
    color: var(--dgc-warning);
    cursor: grab;
    transition: all 0.2s;
    z-index: 15;
    opacity: 0;
    pointer-events: none;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);

    i {
      font-size: 0.875rem;
    }

    &:active {
      cursor: grabbing;
    }

    &:hover {
      background: var(--dgc-warning);
      color: var(--dgc-text-inverse);
      box-shadow: 0 3px 8px rgba(255, 193, 7, 0.4);
    }
  }

  // Row drag handle - positioned at top right of row
  // Shape: Pill/Stadium, Color: Green/Success
  .row-drag-handle {
    position: absolute;
    top: -14px;
    right: -20px;
    width: 40px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--dgc-bg-card);
    border: 2px solid var(--dgc-success);
    border-radius: 14px; // Pill shape
    color: var(--dgc-success);
    cursor: grab;
    transition: all 0.2s;
    z-index: 15;
    opacity: 0;
    pointer-events: none;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);

    i {
      font-size: 0.875rem;
    }

    &:active {
      cursor: grabbing;
    }

    &:hover {
      background: var(--dgc-success);
      color: var(--dgc-text-inverse);
      box-shadow: 0 3px 8px rgba(40, 167, 69, 0.4);
    }
  }

  // Show drag handles on hover (desktop)
  @media (min-width: 1024px) {
    .dashboard-area:hover > .area-controls-overlay .column-drag-handle,
    .dashboard-sub-row:hover > .area-controls-overlay .column-drag-handle,
    .dashboard-sub-row:hover > .area-controls-overlay .row-drag-handle {
      opacity: 1;
      pointer-events: auto;
    }
  }

  // Tablet and mobile: always visible
  @media (max-width: 1023px) {
    .column-drag-handle,
    .row-drag-handle {
      opacity: 1;
      pointer-events: auto;
    }
  }

  // Ghost classes for drag-drop visual feedback
  .column-ghost {
    opacity: 0.4;
    background: rgba($warning, 0.15);
    border: 2px dashed $warning;
    border-radius: 8px;
  }

  .row-ghost {
    opacity: 0.4;
    background: rgba($success, 0.15);
    border: 2px dashed $success;
    border-radius: 6px;
  }

  // Loader styles moved to common _loader.scss

  .responsive-toggle {
    display: flex;
    gap: 0.25rem;
    margin-right: 1rem;

    .breakpoint-btn {
      padding: 0.5rem 0.75rem;
      border: 1px solid var(--dgc-border-color);
      background: var(--dgc-bg-card);
      color: var(--dgc-text-secondary);
      cursor: pointer;
      border-radius: 4px;
      transition: all 0.2s;

      &:hover {
        background: var(--dgc-bg-elevated);
      }

      &.active {
        background: var(--dgc-primary);
        color: var(--dgc-text-inverse);
        border-color: var(--dgc-primary);
      }
    }
  }
}

// Dashboard Name Editor
.dashboard-name-editor {
  display: flex;
  align-items: center;
  gap: 0.5rem;

  h1 {
    margin: 0;
    font-size: $font-size-h2;
    line-height: 1;
  }

  .dashboard-name-input {
    // font-size: $font-size-h2;
    font-weight: 600;
    min-width: 250px;
  }

  .btn-icon {
    width: 32px;
    height: 32px;
    min-width: 32px;
    min-height: 32px;
    padding: 0 !important;
    border-radius: 50% !important;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border: 1px solid var(--dgc-border-color);
    background: var(--dgc-bg-card);
    color: var(--dgc-text-secondary);
    cursor: pointer;
    transition: all 0.2s;
    font-size: 0.875rem;
    flex-shrink: 0;

    &.btn-warning {
      border-color: var(--dgc-warning);
      color: var(--dgc-warning);

      &:hover {
        background: var(--dgc-warning);
        color: var(--dgc-text-inverse);
      }
    }

    &.btn-success {
      border-color: var(--dgc-success);
      color: var(--dgc-success);

      &:hover {
        background: var(--dgc-success);
        color: var(--dgc-text-inverse);
      }
    }

    &.btn-secondary {
      border-color: var(--dgc-text-secondary);
      color: var(--dgc-text-secondary);

      &:hover {
        background: var(--dgc-text-secondary);
        color: var(--dgc-text-inverse);
      }
    }
  }
}

// Save Indicator (matches btn-sm sizing)
.save-indicator {
  display: flex;
  align-items: center;
  gap: 0.375rem;
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
  font-size: 0.8125rem;
  font-weight: 500;
  transition: all 0.3s;

  i {
    font-size: 0.875rem;
  }

  &.saved {
    color: $success;
    background: $success-bg;

    i {
      color: $success;
    }
  }

  &.saving {
    color: $info;
    background: $info-bg;

    i {
      color: $info;
    }
  }

  &.unsaved {
    color: $warning;
    background: $warning-bg;

    i {
      color: $warning;
    }
  }

  &.error {
    color: $error;
    background: $error-bg;

    i {
      color: $error;
    }
  }
}

// ==========================================
// Section Editor Styles
// ==========================================

// Section container for positioning resize handles
.dashboard-section-container {
  position: relative;
  flex: 1;
}

// Column resize controls container (positioned over the grid)
.column-resize-controls {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  pointer-events: none;
  z-index: 20;
}

// Unified area controls overlay - used in both dashboard-area and dashboard-sub-row
.area-controls-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s;
  z-index: 15;
  background: var(--dgc-bg-card);
  border-radius: 6px;
}

// Edge buttons (Add Row / Add Column) - consistent 12px from each edge
.edge-btn {
  position: absolute;
  padding: 0.25rem 0.75rem;
  background: var(--dgc-bg-card);
  border: 1px solid var(--dgc-border-color);
  border-radius: 4px;
  font-size: 0.7rem;
  font-weight: 500;
  color: var(--dgc-text-primary);
  cursor: pointer;
  white-space: nowrap;
  transition: all 0.15s;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);

  &:hover:not([disabled]) {
    background: var(--dgc-primary);
    color: var(--dgc-text-inverse);
    border-color: var(--dgc-primary);
  }

  &[disabled] {
    opacity: 0.5;
    cursor: not-allowed;
    background: var(--dgc-bg-elevated);
  }

  // Top edge - 12px from top
  &.edge-top {
    top: 12px;
    left: 50%;
    transform: translateX(-50%);
  }

  // Bottom edge - 12px from bottom
  &.edge-bottom {
    bottom: 12px;
    left: 50%;
    transform: translateX(-50%);
  }

  // Left edge - visually same distance as top/bottom buttons
  &.edge-left {
    left: 0;
    top: 50%;
    transform: translateX(-50%) translateX(24px) translateY(-50%) rotate(-90deg);
    transform-origin: center;
  }

  // Right edge - visually same distance as top/bottom buttons
  &.edge-right {
    right: 0;
    top: 50%;
    transform: translateX(50%) translateX(-24px) translateY(-50%) rotate(90deg);
    transform-origin: center;
  }
}

// Center controls (resize arrows + delete)
.center-controls {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 2px;
}

.center-row {
  display: flex;
  align-items: center;
  gap: 2px;
}

.center-btn {
  width: 28px;
  height: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--dgc-bg-card);
  border: 1px solid var(--dgc-border-color);
  border-radius: 50%;
  color: var(--dgc-text-primary);
  cursor: pointer;
  font-size: 0.875rem;
  transition: all 0.15s;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.06);

  // Arrow buttons turn primary on hover
  &:hover:not([disabled]) {
    background: var(--dgc-primary);
    color: var(--dgc-text-inverse);
    border-color: var(--dgc-primary);
  }

  &[disabled] {
    opacity: 0.5;
    cursor: not-allowed;
    background: var(--dgc-bg-elevated);
    color: var(--dgc-text-hint);
  }

  // Delete button in center - visible red border, red hover
  &.delete-btn {
    border: 2px solid var(--dgc-error);
    color: var(--dgc-error);

    &:hover:not([disabled]) {
      background: var(--dgc-error);
      color: var(--dgc-text-inverse);
      border-color: var(--dgc-error);
    }
  }
}

// Grid size indicator (positioned at bottom-right on section border, matching Add Section button height)
.grid-size-indicator {
  position: absolute;
  bottom: -16px;
  right: 1rem;
  background: var(--dgc-bg-card);
  border: 1px solid var(--dgc-border-color);
  border-radius: 20px;
  padding: 0.375rem 1rem;
  font-size: 0.8rem;
  font-family: monospace;
  font-weight: 500;
  color: var(--dgc-text-secondary);
  white-space: nowrap;
  opacity: 0;
  pointer-events: none;
  transition: all 0.2s;
  z-index: 10;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  display: flex;
  align-items: center;
  gap: 0.25rem;

  // Column highlight (orange - matches column drag handlers)
  .grid-size-part {
    padding: 0.125rem 0.375rem;
    border-radius: 4px;
    transition: all 0.15s ease;

    &.active {
      background: rgba($warning, 0.15);
      color: var(--dgc-warning);
      font-weight: 600;
    }

    // Nested part doesn't highlight as a whole, only individual rows
    &.grid-size-part-nested {
      &.active {
        background: transparent;
        color: inherit;
        font-weight: 500;
      }
    }
  }

  .grid-size-separator {
    color: var(--dgc-text-hint);
  }

  .grid-size-row-sep {
    color: var(--dgc-text-hint);
  }

  // Row highlight (green - matches row drag handlers)
  .grid-size-row {
    padding: 0.0625rem 0.25rem;
    border-radius: 3px;
    transition: all 0.15s ease;

    &.active {
      background: rgba($success, 0.15);
      color: var(--dgc-success);
      font-weight: 600;
    }
  }
}

// Area controls (split, remove column)
.area-controls {
  position: absolute;
  top: 4px;
  right: 4px;
  display: flex;
  gap: 4px;
  opacity: 0;
  pointer-events: none;
  transition: all 0.2s;
  z-index: 12;

  &.nested-area-controls {
    top: -12px;
    right: 4px;
  }
}

.area-control-btn {
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--dgc-bg-card);
  border: 1px solid var(--dgc-border-color);
  border-radius: 50%;
  color: var(--dgc-text-secondary);
  cursor: pointer;
  font-size: 0.7rem;
  transition: all 0.2s;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);

  &.split-column-btn {
    border-color: var(--dgc-primary);
    color: var(--dgc-primary);

    &:hover {
      background: var(--dgc-primary);
      color: var(--dgc-text-inverse);
    }
  }

  &.remove-column-btn {
    border-color: var(--dgc-error);
    color: var(--dgc-error);

    &:hover {
      background: var(--dgc-error);
      color: var(--dgc-text-inverse);
    }
  }
}

// Old resize styles removed - now using toolbar-style .btn-toolbar-group

// Row controls
.row-controls {
  position: absolute;
  top: 4px;
  right: 4px;
  display: flex;
  gap: 4px;
  opacity: 0;
  pointer-events: none;
  transition: all 0.2s;
  z-index: 12;
}

.row-control-btn {
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--dgc-bg-card);
  border: 1px solid var(--dgc-error);
  border-radius: 50%;
  color: var(--dgc-error);
  cursor: pointer;
  font-size: 0.6rem;
  transition: all 0.2s;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);

  &:hover {
    background: var(--dgc-error);
    color: var(--dgc-text-inverse);
  }
}

// Show controls on hover (desktop)
@media (min-width: 1024px) {
  .dashboard-section-wrapper:hover {
    .grid-size-indicator {
      opacity: 1;
    }
  }

  // Area hover - show controls (works for both dashboard-area and dashboard-sub-row)
  .dashboard-area:hover,
  .dashboard-sub-row:hover {
    > .area-controls-overlay {
      opacity: 1;
      pointer-events: auto;

      .edge-btn,
      .center-btn {
        pointer-events: auto;
      }
    }
  }
}

// Tablet and mobile: always show essential controls
@media (max-width: 1023px) {
  .area-controls-overlay {
    opacity: 1;
    pointer-events: auto;

    .edge-btn,
    .center-btn {
      pointer-events: auto;
    }
  }

  .grid-size-indicator {
    opacity: 1;
  }
}

// Tweak Mode Toggle
// When tweak mode is disabled, hide area-level layout controls but keep section-level controls visible
// Section controls (add section, rearrange section, delete section) remain available in design mode
.dashboard-builder.layout-edit-disabled {
  // Hide area controls overlay (resize buttons, add row/col buttons within areas)
  .area-controls-overlay {
    display: none !important;
  }

  // Hide column and row drag handles (within sections)
  .column-drag-handle,
  .row-drag-handle {
    display: none !important;
  }

  // Keep empty state visible and clickable
  .dashboard-cell-empty {
    cursor: pointer;

    &:hover {
      border-color: $primary;
    }
  }
}

