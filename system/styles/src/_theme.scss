// Theme System - Light/Dark Mode Support
// Uses CSS custom properties for dynamic theme switching

@use "variables" as *;

// ===========================================
// CSS Custom Properties (Theme Variables)
// ===========================================

:root {
  // Light theme (default)
  --dgc-primary: #{$primary};
  --dgc-primary-light: #{$primary-light};
  --dgc-primary-dark: #{$primary-dark};

  --dgc-secondary: #{$secondary};
  --dgc-secondary-light: #{$secondary-light};
  --dgc-secondary-dark: #{$secondary-dark};

  // Status colors
  --dgc-success: #{$success};
  --dgc-success-light: #{$success-light};
  --dgc-success-dark: #{$success-dark};
  --dgc-success-bg: #{$success-bg};
  --dgc-success-border: #{$success-border};

  --dgc-warning: #{$warning};
  --dgc-warning-light: #{$warning-light};
  --dgc-warning-dark: #{$warning-dark};
  --dgc-warning-bg: #{$warning-bg};
  --dgc-warning-border: #{$warning-border};

  --dgc-error: #{$error};
  --dgc-error-light: #{$error-light};
  --dgc-error-dark: #{$error-dark};
  --dgc-error-bg: #{$error-bg};
  --dgc-error-border: #{$error-border};

  --dgc-info: #{$info};
  --dgc-info-light: #{$info-light};
  --dgc-info-dark: #{$info-dark};
  --dgc-info-bg: #{$info-bg};
  --dgc-info-border: #{$info-border};

  // Grays
  --dgc-gray-50: #{$gray-50};
  --dgc-gray-100: #{$gray-100};
  --dgc-gray-200: #{$gray-200};
  --dgc-gray-300: #{$gray-300};
  --dgc-gray-400: #{$gray-400};
  --dgc-gray-500: #{$gray-500};
  --dgc-gray-600: #{$gray-600};
  --dgc-gray-700: #{$gray-700};
  --dgc-gray-800: #{$gray-800};
  --dgc-gray-900: #{$gray-900};

  // Backgrounds
  --dgc-bg-body: #{$bg-body};
  --dgc-bg-card: #{$bg-card};
  --dgc-bg-elevated: #{$gray-100};
  --dgc-bg-sidebar: #{$bg-sidebar};
  --dgc-bg-input: #ffffff;
  --dgc-bg-hover: #{$gray-50};

  // Text colors
  --dgc-text-primary: #{$text-primary};
  --dgc-text-secondary: #{$text-secondary};
  --dgc-text-disabled: #{$text-disabled};
  --dgc-text-hint: #{$text-hint};
  --dgc-text-inverse: #ffffff;

  // Borders
  --dgc-border-color: #{$border-color};

  // Shadows
  --dgc-shadow-subtle: #{$shadow-subtle};
  --dgc-shadow-1: #{$shadow-1};
  --dgc-shadow-2: #{$shadow-2};
  --dgc-shadow-3: #{$shadow-3};

  // Loading overlay
  --dgc-loading-overlay-bg: rgba(255, 255, 255, 0.8);

  // Code/monospace backgrounds
  --dgc-code-bg: #{$gray-100};
  --dgc-code-color: #{$gray-800};

  // Scrollbar
  --dgc-scrollbar-track: #{$gray-100};
  --dgc-scrollbar-thumb: #{$gray-300};
  --dgc-scrollbar-thumb-hover: #{$gray-400};

  // Toggle switch
  --dgc-toggle-inactive: #{$gray-300};

  // Layout grid
  --dgc-layout-row-height: #{$layout-row-height};

  // CodeMirror syntax highlighting (light mode)
  --dgc-cm-keyword: #7c3aed;
  --dgc-cm-variable: #0891b2;
  --dgc-cm-string: #059669;
  --dgc-cm-number: #d97706;
  --dgc-cm-builtin: #dc2626;
}

// ===========================================
// Dark Theme Variables
// ===========================================

:root.theme-dark,
[data-theme="dark"] {
  // Primary colors stay similar but slightly adjusted
  --dgc-primary: #4da3ff;
  --dgc-primary-light: #7ab8ff;
  --dgc-primary-dark: #1a8cff;

  --dgc-secondary: #a0a0a0;
  --dgc-secondary-light: #c0c0c0;
  --dgc-secondary-dark: #707070;

  // Status colors - brighter for dark mode
  --dgc-success: #5fd068;
  --dgc-success-light: #81dc88;
  --dgc-success-dark: #3cb44b;
  --dgc-success-bg: rgba(76, 175, 80, 0.15);
  --dgc-success-border: rgba(76, 175, 80, 0.3);

  --dgc-warning: #ffb74d;
  --dgc-warning-light: #ffc77d;
  --dgc-warning-dark: #ff9800;
  --dgc-warning-bg: rgba(255, 152, 0, 0.15);
  --dgc-warning-border: rgba(255, 152, 0, 0.3);

  --dgc-error: #ff6b6b;
  --dgc-error-light: #ff8a8a;
  --dgc-error-dark: #f44336;
  --dgc-error-bg: rgba(244, 67, 54, 0.15);
  --dgc-error-border: rgba(244, 67, 54, 0.3);

  --dgc-info: #64b5f6;
  --dgc-info-light: #90caf9;
  --dgc-info-dark: #42a5f5;
  --dgc-info-bg: rgba(33, 150, 243, 0.15);
  --dgc-info-border: rgba(33, 150, 243, 0.3);

  // Grays - inverted for dark mode
  --dgc-gray-50: #1a1a1a;
  --dgc-gray-100: #242424;
  --dgc-gray-200: #2d2d2d;
  --dgc-gray-300: #3d3d3d;
  --dgc-gray-400: #525252;
  --dgc-gray-500: #737373;
  --dgc-gray-600: #a3a3a3;
  --dgc-gray-700: #d4d4d4;
  --dgc-gray-800: #e5e5e5;
  --dgc-gray-900: #f5f5f5;

  // Backgrounds
  --dgc-bg-body: #121212;
  --dgc-bg-card: #1e1e1e;
  --dgc-bg-elevated: #2a2a2a;
  --dgc-bg-sidebar: #1a1a1a;
  --dgc-bg-input: #2a2a2a;
  --dgc-bg-hover: #2d2d2d;

  // Text colors
  --dgc-text-primary: rgba(255, 255, 255, 0.87);
  --dgc-text-secondary: rgba(255, 255, 255, 0.6);
  --dgc-text-disabled: rgba(255, 255, 255, 0.38);
  --dgc-text-hint: rgba(255, 255, 255, 0.38);
  --dgc-text-inverse: #121212;

  // Borders
  --dgc-border-color: #3d3d3d;

  // Shadows - darker for dark mode, all sides
  --dgc-shadow-subtle: 0 0 4px rgba(0, 0, 0, 0.2), 0 0 8px rgba(0, 0, 0, 0.15);
  --dgc-shadow-1: 0 0 4px rgba(0, 0, 0, 0.3), 0 0 2px rgba(0, 0, 0, 0.2);
  --dgc-shadow-2: 0 0 8px rgba(0, 0, 0, 0.35), 0 0 4px rgba(0, 0, 0, 0.25);
  --dgc-shadow-3: 0 0 16px rgba(0, 0, 0, 0.4), 0 0 8px rgba(0, 0, 0, 0.3);

  // Loading overlay
  --dgc-loading-overlay-bg: rgba(18, 18, 18, 0.85);

  // Code/monospace backgrounds
  --dgc-code-bg: #2d2d2d;
  --dgc-code-color: #e5e5e5;

  // Scrollbar
  --dgc-scrollbar-track: #1a1a1a;
  --dgc-scrollbar-thumb: #3d3d3d;
  --dgc-scrollbar-thumb-hover: #525252;

  // Toggle switch - brighter for dark mode visibility
  --dgc-toggle-inactive: #5a5a5a;

  // CodeMirror syntax highlighting (dark mode - brighter colors)
  --dgc-cm-keyword: #a78bfa;
  --dgc-cm-variable: #22d3ee;
  --dgc-cm-string: #34d399;
  --dgc-cm-number: #fbbf24;
  --dgc-cm-builtin: #f87171;
}

// ===========================================
// Theme-Aware Base Styles
// ===========================================

body {
  background-color: var(--dgc-bg-body);
  color: var(--dgc-text-primary);
  transition:
    background-color 0.2s ease,
    color 0.2s ease;
}

// ===========================================
// Header Separator (vertical line before theme toggle)
// ===========================================

.header-separator {
  width: 1px;
  height: 24px;
  background: var(--dgc-border-color);
  margin: 0 0.25rem;
}

// ===========================================
// Theme Toggle Button
// ===========================================

.theme-toggle-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 36px;
  height: 36px;
  padding: 0;
  background: var(--dgc-gray-100);
  border: none;
  border-radius: 10px;
  color: var(--dgc-text-secondary);
  cursor: pointer;
  position: relative;
  overflow: hidden;

  // Background layers for smooth gradient transition
  &::before,
  &::after {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    transition: opacity 0.3s ease;
    pointer-events: none;
  }

  // System mode gradient (blue)
  &::before {
    background: linear-gradient(135deg, #e0f2fe 0%, #dbeafe 100%);
    opacity: 0;
  }

  // Light mode gradient (amber) - uses after for light
  &::after {
    background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
    opacity: 0;
  }

  i {
    font-size: 16px;
    transition: color 0.3s ease;
    position: relative;
    z-index: 1;
  }

  // Slide out animations - direction based on sequence
  &.icon-slide-out-left {
    i {
      animation: iconSlideOutLeft 0.15s ease-in forwards;
    }
  }

  &.icon-slide-out-right {
    i {
      animation: iconSlideOutRight 0.15s ease-in forwards;
    }
  }

  // Slide in animations - direction based on sequence
  &.icon-slide-in-right {
    i {
      animation: iconSlideInRight 0.15s ease-out forwards;
    }
  }

  &.icon-slide-in-left {
    i {
      animation: iconSlideInLeft 0.15s ease-out forwards;
    }
  }

  &:focus {
    outline: none;
  }

  &:focus-visible {
    outline: none;
    box-shadow: 0 0 0 3px rgba(#0284c7, 0.3);
  }

  // Mode-specific styling - use opacity transitions for smooth effect
  &[data-mode="system"] {
    &::before {
      opacity: 1;
    }

    &::after {
      opacity: 0;
    }

    i {
      color: #0284c7; // Sky blue for system
    }

    &:hover::before {
      background: linear-gradient(135deg, #bae6fd 0%, #bfdbfe 100%);
    }
  }

  &[data-mode="light"] {
    &::before {
      opacity: 0;
    }

    &::after {
      opacity: 1;
    }

    i {
      color: #d97706; // Amber for light/sun
    }

    &:hover::after {
      background: linear-gradient(135deg, #fde68a 0%, #fcd34d 100%);
    }
  }

  &[data-mode="dark"] {
    // Dark uses a third layer via background on the element itself
    background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);

    &::before,
    &::after {
      opacity: 0;
    }

    i {
      color: #4f46e5; // Indigo for dark/moon
    }

    &:hover {
      background: linear-gradient(135deg, #c7d2fe 0%, #a5b4fc 100%);
    }
  }
}

// Dark mode adjustments for theme toggle
:root.theme-dark {
  .header-separator {
    background: var(--dgc-gray-400);
  }

  .theme-toggle-btn {
    // Update pseudo-element gradients for dark mode
    &::before {
      background: linear-gradient(135deg, #0c4a6e 0%, #1e3a5f 100%);
    }

    &::after {
      background: linear-gradient(135deg, #78350f 0%, #92400e 100%);
    }

    &:focus-visible {
      box-shadow: 0 0 0 3px rgba(#7dd3fc, 0.4);
    }

    &[data-mode="system"] {
      i {
        color: #7dd3fc;
      }

      &:hover::before {
        background: linear-gradient(135deg, #0e5a82 0%, #254670 100%);
      }
    }

    &[data-mode="light"] {
      i {
        color: #fbbf24;
      }

      &:hover::after {
        background: linear-gradient(135deg, #92400e 0%, #a16207 100%);
      }
    }

    &[data-mode="dark"] {
      background: linear-gradient(135deg, #312e81 0%, #3730a3 100%);

      i {
        color: #a5b4fc;
      }

      &:hover {
        background: linear-gradient(135deg, #3730a3 0%, #4338ca 100%);
      }
    }
  }
}

// Icon slide animation keyframes
// Slide out to left (moving forward: light->dark, dark->system)
@keyframes iconSlideOutLeft {
  0% {
    transform: translateX(0);
    opacity: 1;
  }
  100% {
    transform: translateX(-20px);
    opacity: 0;
  }
}

// Slide out to right (moving backward: system->light)
@keyframes iconSlideOutRight {
  0% {
    transform: translateX(0);
    opacity: 1;
  }
  100% {
    transform: translateX(20px);
    opacity: 0;
  }
}

// Slide in from right (moving forward: light->dark, dark->system)
@keyframes iconSlideInRight {
  0% {
    transform: translateX(20px);
    opacity: 0;
  }
  100% {
    transform: translateX(0);
    opacity: 1;
  }
}

// Slide in from left (moving backward: system->light)
@keyframes iconSlideInLeft {
  0% {
    transform: translateX(-20px);
    opacity: 0;
  }
  100% {
    transform: translateX(0);
    opacity: 1;
  }
}

// ===========================================
// Component Theme Overrides
// ===========================================

// Cards
.card {
  background: var(--dgc-bg-card);
  box-shadow: var(--dgc-shadow-subtle);

  .card-header {
    border-color: var(--dgc-border-color);

    h2,
    h3 {
      color: var(--dgc-text-primary);
    }
  }

  .card-header-left {
    h2,
    h3 {
      color: var(--dgc-text-primary);
    }

    .text-muted {
      color: var(--dgc-text-secondary) !important;

      i {
        color: var(--dgc-primary);
      }
    }
  }
}

// Page header
.page-header {
  background: var(--dgc-bg-card);
  box-shadow: var(--dgc-shadow-1);

  h1 {
    color: var(--dgc-text-primary);
  }

  .breadcrumb {
    color: var(--dgc-text-secondary);

    a {
      color: var(--dgc-text-secondary);

      &:hover {
        color: var(--dgc-primary);
      }
    }

    i {
      color: var(--dgc-text-hint);
    }

    span {
      color: var(--dgc-text-primary);
    }
  }
}

// Form controls
.form-control,
.form-select,
select {
  background-color: var(--dgc-bg-input);
  border-color: var(--dgc-border-color);
  color: var(--dgc-text-primary);

  &::placeholder {
    color: var(--dgc-text-hint);
  }

  &:focus {
    background-color: var(--dgc-bg-input);
    border-color: var(--dgc-primary);
    color: var(--dgc-text-primary);
  }

  option {
    background-color: var(--dgc-bg-card);
    color: var(--dgc-text-primary);
  }
}

// Dark mode specific select fixes
:root.theme-dark {
  select,
  .form-select,
  select.form-control {
    background-color: var(--dgc-bg-input);
    color: var(--dgc-text-primary);

    option {
      background-color: #2a2a2a;
      color: rgba(255, 255, 255, 0.87);
    }
  }

  // Secondary button - ensure text is visible on dark background
  .btn-secondary {
    --bs-btn-color: rgba(255, 255, 255, 0.87);
    --bs-btn-hover-color: rgba(255, 255, 255, 0.87);
  }
}

// Tables
.table {
  color: var(--dgc-text-primary);

  th,
  td {
    border-color: var(--dgc-border-color);
  }

  th {
    background: var(--dgc-gray-50);
    color: var(--dgc-text-secondary);
  }

  tbody tr:hover {
    background: var(--dgc-bg-hover);
  }
}

// Alerts
.alert-success {
  background: var(--dgc-success-bg);
  color: var(--dgc-success-dark);
  border-color: var(--dgc-success-border);
}

.alert-error {
  background: var(--dgc-error-bg);
  color: var(--dgc-error-dark);
  border-color: var(--dgc-error-border);
}

.alert-warning {
  background: var(--dgc-warning-bg);
  color: var(--dgc-warning-dark);
  border-color: var(--dgc-warning-border);
}

.alert-info {
  background: var(--dgc-info-bg);
  color: var(--dgc-info-dark);
  border-color: var(--dgc-info-border);
}

// Toast notifications
.dgc-toast {
  background: var(--dgc-bg-card);
  box-shadow: var(--dgc-shadow-2);

  .dgc-toast-close {
    color: var(--dgc-text-hint);

    &:hover {
      color: var(--dgc-text-primary);
    }
  }
}

// Loading overlay
.loading-overlay {
  background: var(--dgc-loading-overlay-bg);

  .loading-spinner span {
    color: var(--dgc-text-secondary);
  }
}

// Code elements
code {
  background: var(--dgc-code-bg);
  color: var(--dgc-code-color);
}

// Text utility classes
.text-muted {
  color: var(--dgc-text-secondary) !important;
}

// Collapsible panels
.collapsible-panel {
  background: var(--dgc-bg-card);
  box-shadow: var(--dgc-shadow-subtle);
}

.collapsible-header {
  border-color: var(--dgc-border-color);

  &:hover {
    background: var(--dgc-bg-hover);
  }

  h3 {
    color: var(--dgc-text-primary);
  }
}

// Sidebar sections
.sidebar-section {
  border-color: var(--dgc-border-color);
}

// Graph main area (inherits from .card)
.graph-preview-card {
  border-color: var(--dgc-border-color);
}

.graph-preview-container {
  border-color: var(--dgc-border-color);
  background: var(--dgc-gray-50);
}

// Buttons - use theme variables
.btn-secondary {
  --bs-btn-bg: var(--dgc-gray-200);
  --bs-btn-border-color: var(--dgc-gray-200);
  --bs-btn-color: var(--dgc-text-primary);
  --bs-btn-hover-bg: var(--dgc-gray-300);
  --bs-btn-hover-border-color: var(--dgc-gray-300);
  --bs-btn-hover-color: var(--dgc-text-primary);
}

.btn-outline-secondary {
  --bs-btn-color: var(--dgc-text-secondary);
  --bs-btn-border-color: var(--dgc-gray-300);
  --bs-btn-hover-bg: var(--dgc-gray-100);
  --bs-btn-hover-border-color: var(--dgc-gray-400);
  --bs-btn-hover-color: var(--dgc-text-primary);
}

// Collapse button
.collapse-btn {
  background: var(--dgc-bg-card);
  border-color: var(--dgc-gray-300);
  color: var(--dgc-text-secondary);

  &:hover {
    background: var(--dgc-primary);
    border-color: var(--dgc-primary);
    color: var(--dgc-text-inverse);
  }
}

// Filter items
.filter-input-item {
  background: var(--dgc-gray-50);
  border-color: var(--dgc-border-color);

  &:hover {
    border-color: var(--dgc-primary-light);
  }
}

.filter-selector-item {
  background: var(--dgc-gray-50);
  border-color: var(--dgc-border-color);

  &:hover {
    border-color: var(--dgc-primary-light);
    background: var(--dgc-bg-card);
  }

  &:has(input:checked) {
    border-color: var(--dgc-primary);
    background: rgba(0, 123, 255, 0.05);
  }
}

// Checkbox/radio groups
.filter-checkbox-group,
.filter-radio-group {
  background: var(--dgc-bg-input);
  border-color: var(--dgc-border-color);
}

// Multiselect dropdown
.filter-multiselect-trigger {
  border-color: var(--dgc-border-color);
  background: var(--dgc-bg-input);

  &:hover {
    border-color: var(--dgc-gray-400);
  }

  i {
    color: var(--dgc-text-hint);
  }
}

.filter-multiselect-placeholder {
  color: var(--dgc-text-hint);
}

.filter-multiselect-options {
  background: var(--dgc-bg-card);
  border-color: var(--dgc-border-color);
  box-shadow: var(--dgc-shadow-2);
}

.filter-multiselect-option {
  color: var(--dgc-text-secondary);

  &:hover {
    background: var(--dgc-gray-50);
  }
}

// Query editor
.query-editor-wrapper {
  background: var(--dgc-bg-input);
  border-color: var(--dgc-border-color);
}

.query-editor {
  background: transparent;
  color: var(--dgc-text-primary);
}

// Chart type selector
.chart-type-item {
  background: var(--dgc-gray-50);
  border-color: var(--dgc-border-color);

  i,
  span {
    color: var(--dgc-text-secondary);
  }

  &:hover {
    border-color: var(--dgc-primary-light);
    background: rgba(0, 123, 255, 0.02);

    i,
    span {
      color: var(--dgc-text-primary);
    }
  }

  &.active {
    border-color: var(--dgc-primary);
    background: rgba(0, 123, 255, 0.08);

    i,
    span {
      color: var(--dgc-primary);
    }
  }
}

// Sidebar tabs
.sidebar-tab {
  background: var(--dgc-gray-50);
  border-color: var(--dgc-border-color);
  color: var(--dgc-text-secondary);

  &:hover {
    color: var(--dgc-text-primary);
    background: var(--dgc-gray-100);
  }

  &.active {
    color: var(--dgc-primary);
    background: rgba(0, 123, 255, 0.08);
    border-color: var(--dgc-primary);
  }
}

// Query tabs
.query-tab {
  color: var(--dgc-text-secondary);
  border-color: transparent;

  &:hover {
    color: var(--dgc-text-primary);
  }

  &.active {
    color: var(--dgc-primary);
    border-color: var(--dgc-primary);
  }
}

// Save bar
.graph-save-bar {
  border-color: var(--dgc-border-color);
}

// Config sections
.config-section {
  border-color: var(--dgc-border-color);

  h4 {
    color: var(--dgc-text-secondary);
  }
}

.config-section-title {
  color: var(--dgc-text-secondary);
}

.config-row-label {
  color: var(--dgc-text-primary);
}

// Empty state
.empty-state {
  .empty-state-content {
    h3 {
      color: var(--dgc-text-primary);
    }

    p {
      color: var(--dgc-text-secondary);
    }
  }
}

// ===========================================
// Text Switch Dark Mode Overrides
// ===========================================

:root.theme-dark {
  .text-switch {
    // Off state - improve text visibility on dark background
    .text-switch-label.label-text {
      color: rgba(255, 255, 255, 0.6); // Lighter text for dark mode
    }

    // Off state track background
    .form-check-input:not(:checked) {
      background-color: var(--dgc-gray-300);
    }

    // Knob stays white/light in dark mode (same as light mode)
    .text-switch-knob {
      background: white;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    }

    // Checked state text stays white (already good)
    .form-check-input:checked ~ .text-switch-track .label-text {
      color: white;
    }
  }
}

// ===========================================
// Dashboard Builder Button Shadows (Dark Mode)
// ===========================================
// In dark mode, buttons need stronger shadows with subtle glow for depth

:root.theme-dark {
  // Override builder button shadows for better dark mode visibility
  .dashboard-builder,
  .template-builder-page .dashboard-builder {
    // Section border buttons (Add Section Above/Below)
    .add-section-border-btn {
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4),
        0 0 0 1px hsla(0, 0%, 100%, 0.3),
        0 0 12px rgba(0, 123, 255, 0.15);

      &:hover:not([disabled]) {
        box-shadow: 0 4px 16px rgba(0, 123, 255, 0.5),
          0 0 0 1px rgba(0, 123, 255, 0.3),
          0 0 20px rgba(0, 123, 255, 0.25);
      }
    }

    // Section top border controls (drag handle, delete)
    .section-top-border-controls .section-control-btn {
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4),
        0 0 0 1px hsla(0, 0%, 100%, 0.3);

      &.drag-handle:hover {
        box-shadow: 0 4px 16px rgba(0, 123, 255, 0.5),
          0 0 0 1px rgba(0, 123, 255, 0.3);
      }

      &.remove-btn:hover {
        box-shadow: 0 4px 16px rgba(244, 67, 54, 0.5),
          0 0 0 1px rgba(244, 67, 54, 0.3);
      }
    }

    // Column drag handle (orange/warning)
    .column-drag-handle {
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4),
        0 0 0 1px hsla(0, 0%, 100%, 0.3),
        0 0 12px rgba(255, 193, 7, 0.2);

      &:hover:not([disabled]) {
        box-shadow: 0 4px 16px rgba(255, 193, 7, 0.5),
          0 0 0 1px rgba(255, 193, 7, 0.3),
          0 0 20px rgba(255, 193, 7, 0.25);
      }
    }

    // Row drag handle (green/success)
    .row-drag-handle {
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4),
        0 0 0 1px hsla(0, 0%, 100%, 0.3),
        0 0 12px rgba(40, 167, 69, 0.2);

      &:hover:not([disabled]) {
        box-shadow: 0 4px 16px rgba(40, 167, 69, 0.5),
          0 0 0 1px rgba(40, 167, 69, 0.3),
          0 0 20px rgba(40, 167, 69, 0.25);
      }
    }

    // Edge buttons (Add Row / Add Column)
    .edge-btn {
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4),
        0 0 0 1px hsla(0, 0%, 100%, 0.3);

      // Row buttons (top/bottom - green)
      &.edge-top,
      &.edge-bottom {
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4),
          0 0 0 1px hsla(0, 0%, 100%, 0.3),
          0 0 12px rgba(40, 167, 69, 0.15);

        &:hover:not([disabled]) {
          box-shadow: 0 4px 16px rgba(40, 167, 69, 0.5),
            0 0 0 1px rgba(40, 167, 69, 0.3),
            0 0 20px rgba(40, 167, 69, 0.25);
        }
      }

      // Column buttons (left/right - orange)
      &.edge-left,
      &.edge-right {
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4),
          0 0 0 1px hsla(0, 0%, 100%, 0.3),
          0 0 12px rgba(255, 193, 7, 0.15);

        &:hover:not([disabled]) {
          box-shadow: 0 4px 16px rgba(255, 193, 7, 0.5),
            0 0 0 1px rgba(255, 193, 7, 0.3),
            0 0 20px rgba(255, 193, 7, 0.25);
        }
      }
    }

    // Center controls (resize arrows + delete)
    .center-btn {
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4),
        0 0 0 1px hsla(0, 0%, 100%, 0.3);

      // Row resize (green)
      &.row-resize:hover:not([disabled]) {
        box-shadow: 0 4px 16px rgba(40, 167, 69, 0.5),
          0 0 0 1px rgba(40, 167, 69, 0.3);
      }

      // Column resize (orange)
      &.col-resize:hover:not([disabled]) {
        box-shadow: 0 4px 16px rgba(255, 193, 7, 0.5),
          0 0 0 1px rgba(255, 193, 7, 0.3);
      }

      // Delete button (red)
      &.delete-btn {
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4),
          0 0 0 1px hsla(0, 0%, 100%, 0.3),
          0 0 12px rgba(244, 67, 54, 0.2);

        &:hover:not([disabled]) {
          box-shadow: 0 4px 16px rgba(244, 67, 54, 0.5),
            0 0 0 1px rgba(244, 67, 54, 0.3),
            0 0 20px rgba(244, 67, 54, 0.25);
        }
      }
    }

    // Grid size indicator
    .grid-size-indicator {
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4),
        0 0 0 1px hsla(0, 0%, 100%, 0.3);
    }

    // Area control buttons (split, remove column)
    .area-control-btn {
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4),
        0 0 0 1px hsla(0, 0%, 100%, 0.3);

      &.split-column-btn:hover {
        box-shadow: 0 4px 16px rgba(0, 123, 255, 0.5),
          0 0 0 1px rgba(0, 123, 255, 0.3);
      }

      &.remove-column-btn:hover {
        box-shadow: 0 4px 16px rgba(244, 67, 54, 0.5),
          0 0 0 1px rgba(244, 67, 54, 0.3);
      }
    }

    // Row control button (delete row)
    .row-control-btn {
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4),
        0 0 0 1px hsla(0, 0%, 100%, 0.3),
        0 0 12px rgba(244, 67, 54, 0.2);

      &:hover:not([disabled]) {
        box-shadow: 0 4px 16px rgba(244, 67, 54, 0.5),
          0 0 0 1px rgba(244, 67, 54, 0.3);
      }
    }

    // Area controls overlay background in dark mode
    .area-controls-overlay {
      background: var(--dgc-bg-card);
    }
  }
}

// Scrollbar styling for dark mode
:root.theme-dark {
  // Webkit browsers
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }

  ::-webkit-scrollbar-track {
    background: var(--dgc-scrollbar-track);
  }

  ::-webkit-scrollbar-thumb {
    background: var(--dgc-scrollbar-thumb);
    border-radius: 4px;

    &:hover {
      background: var(--dgc-scrollbar-thumb-hover);
    }
  }

  // Firefox
  * {
    scrollbar-width: thin;
    scrollbar-color: var(--dgc-scrollbar-thumb) var(--dgc-scrollbar-track);
  }
}

// Bootstrap modal overrides
.modal-content {
  background-color: var(--dgc-bg-card);
  color: var(--dgc-text-primary);
  border-color: var(--dgc-border-color);
}

.modal-header {
  border-color: var(--dgc-border-color);
}

.modal-footer {
  border-color: var(--dgc-border-color);
}

// Dark mode close button fix
:root.theme-dark {
  .btn-close {
    filter: invert(1) grayscale(100%) brightness(200%);
  }
}

// Dropdown menus
.dropdown-menu {
  background-color: var(--dgc-bg-card);
  border-color: var(--dgc-border-color);
  box-shadow: var(--dgc-shadow-2);
}

.dropdown-item {
  color: var(--dgc-text-primary);

  &:hover,
  &:focus {
    background-color: var(--dgc-bg-hover);
    color: var(--dgc-text-primary);
  }
}

.dropdown-divider {
  border-color: var(--dgc-border-color);
}

// ===========================================
// Keyboard Shortcuts Modal
// ===========================================

.keyboard-shortcuts-modal {
  .modal-header {
    padding: 1rem 1.25rem;
    flex-wrap: wrap;
    gap: 0.5rem;

    .modal-title {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 1.1rem;
      font-weight: 500;

      i {
        color: var(--dgc-primary);
      }
    }

    .shortcuts-expand-collapse {
      margin-left: auto;
      margin-right: 0.5rem;

      .btn-link {
        padding: 0;
        font-size: 0.75rem;
        text-decoration: none;
        color: var(--dgc-primary);

        &:hover {
          text-decoration: underline;
        }
      }
    }
  }

  .modal-body {
    padding: 0.5rem 1.25rem 1.25rem;
    max-height: 60vh;
    overflow-y: auto;
  }
}

.shortcuts-group {
  margin-bottom: 0.75rem;
  border: 1px solid var(--dgc-border-color);
  border-radius: 6px;
  overflow: hidden;

  &:last-child {
    margin-bottom: 0;
  }

  &.collapsed {
    .shortcuts-list {
      display: none;
    }

    .shortcuts-group-toggle {
      transform: rotate(180deg);
    }
  }
}

.shortcuts-group-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.5rem 0.75rem;
  background: var(--dgc-gray-100);
  cursor: pointer;
  user-select: none;
  transition: background-color 0.15s ease;

  &:hover {
    background: var(--dgc-gray-200);
  }
}

.shortcuts-group-title {
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--dgc-text-secondary);
  margin: 0;
}

.shortcuts-group-toggle {
  font-size: 0.625rem;
  color: var(--dgc-text-hint);
  transition: transform 0.2s ease;
}

.shortcuts-list {
  display: flex;
  flex-direction: column;
  gap: 0.375rem;
  padding: 0.5rem;
}

.shortcut-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.5rem 0.75rem;
  border-radius: 6px;
  background: var(--dgc-gray-50);
  transition: background-color 0.15s ease;

  &:hover {
    background: var(--dgc-gray-100);
  }

  &.disabled {
    opacity: 0.45;

    kbd {
      background: var(--dgc-gray-200);
      color: var(--dgc-text-hint);
    }
  }
}

.shortcut-keys {
  display: flex;
  align-items: center;
  gap: 0.25rem;

  kbd {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 28px;
    height: 26px;
    padding: 0 0.5rem;
    font-family: inherit;
    font-size: 0.75rem;
    font-weight: 500;
    color: var(--dgc-text-primary);
    background: var(--dgc-bg-card);
    border: 1px solid var(--dgc-border-color);
    border-radius: 4px;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05), 0 2px 0 0 var(--dgc-gray-200);
  }

  .key-separator {
    color: var(--dgc-text-hint);
    font-size: 0.7rem;
    margin: 0 0.125rem;
  }
}

.shortcut-description {
  font-size: 0.875rem;
  color: var(--dgc-text-secondary);
}

.shortcuts-hint {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-top: 1rem;
  padding: 0.625rem 0.75rem;
  font-size: 0.75rem;
  color: var(--dgc-text-hint);
  background: var(--dgc-gray-50);
  border-radius: 6px;

  i {
    font-size: 0.875rem;
  }
}

// Dark mode adjustments for keyboard shortcuts
:root.theme-dark {
  .shortcut-keys kbd {
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2), 0 2px 0 0 var(--dgc-gray-300);
  }
}
